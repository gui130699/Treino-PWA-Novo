<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Final - Novas Chaves Supabase</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 5px;
            width: 100%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        button:hover { transform: translateY(-2px); }
        .result {
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        .result.success { border-color: #4caf50; background: #e8f5e9; }
        .result.error { border-color: #f44336; background: #ffebee; }
        .status { 
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin: 10px 0;
        }
        .status.success { background: #4caf50; color: white; }
        .status.error { background: #f44336; color: white; }
        .status.pending { background: #ff9800; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Teste Final - Novas Chaves</h1>
        
        <div class="card">
            <h2>Teste de Cadastro Completo</h2>
            <p>Este teste vai:</p>
            <ul style="margin: 15px 0 15px 30px; line-height: 2;">
                <li>âœ… Conectar com as novas chaves publicÃ¡veis</li>
                <li>âœ… Criar um usuÃ¡rio de teste</li>
                <li>âœ… Verificar se foi salvo no banco</li>
            </ul>
            
            <button onclick="testarCadastroCompleto()">ğŸš€ TESTAR CADASTRO AGORA</button>
            
            <div id="resultado"></div>
        </div>
        
        <div class="card">
            <h3>ğŸ“‹ InformaÃ§Ãµes do Projeto</h3>
            <p><strong>URL:</strong> https://bshcttzscofsnysiuaro.supabase.co</p>
            <p><strong>Chave:</strong> sb_publishable_c8kMhX2Y4gtPwjJ53SUdcw_tvDCCGYw</p>
            <p><strong>Tabela:</strong> usuarios</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script>
        const SUPABASE_URL = 'https://bshcttzscofsnysiuaro.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_c8kMhX2Y4gtPwjJ53SUdcw_tvDCCGYw';
        
        let client = null;
        
        function mostrarResultado(mensagem, tipo) {
            const div = document.getElementById('resultado');
            div.className = `result ${tipo}`;
            div.textContent = mensagem;
        }
        
        async function testarCadastroCompleto() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'â³ Testando...';
            
            try {
                // 1. Criar cliente
                mostrarResultado('ğŸ”„ Passo 1/4: Criando cliente Supabase...', '');
                await new Promise(r => setTimeout(r, 500));
                
                if (typeof supabase === 'undefined') {
                    throw new Error('SDK do Supabase nÃ£o carregado!');
                }
                
                client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {
                    auth: {
                        persistSession: false,
                        autoRefreshToken: false
                    },
                    db: {
                        schema: 'public'
                    }
                });
                
                mostrarResultado('âœ… Passo 1/4: Cliente criado com sucesso!\n\nğŸ”„ Passo 2/4: Verificando tabela usuarios...', 'success');
                await new Promise(r => setTimeout(r, 500));
                
                // 2. Verificar tabela
                const { data: testRead, error: errorRead } = await client
                    .from('usuarios')
                    .select('id')
                    .limit(1);
                
                if (errorRead) {
                    throw new Error(`Erro ao acessar tabela: ${errorRead.message}\n\nCÃ³digo: ${errorRead.code}\nDetalhes: ${errorRead.details || 'N/A'}\nHint: ${errorRead.hint || 'N/A'}`);
                }
                
                mostrarResultado('âœ… Passo 2/4: Tabela acessÃ­vel!\n\nğŸ”„ Passo 3/4: Criando usuÃ¡rio de teste...', 'success');
                await new Promise(r => setTimeout(r, 500));
                
                // 3. Criar usuÃ¡rio
                const timestamp = Date.now();
                const dadosTeste = {
                    tipo: 'aluno',
                    nome_completo: 'Teste Final Completo',
                    email: `teste_final_${timestamp}@teste.com`,
                    senha: 'senha123456',
                    data_nascimento: '2000-01-15',
                    idade: 26,
                    peso: 75.0,
                    altura: 175.0
                };
                
                const { data: novoUsuario, error: errorInsert } = await client
                    .from('usuarios')
                    .insert([dadosTeste])
                    .select()
                    .single();
                
                if (errorInsert) {
                    throw new Error(`Erro ao inserir usuÃ¡rio: ${errorInsert.message}\n\nCÃ³digo: ${errorInsert.code}\nDetalhes: ${errorInsert.details || 'N/A'}\nHint: ${errorInsert.hint || 'N/A'}\n\nDados enviados:\n${JSON.stringify(dadosTeste, null, 2)}`);
                }
                
                mostrarResultado('âœ… Passo 3/4: UsuÃ¡rio criado!\n\nğŸ”„ Passo 4/4: Verificando se foi salvo...', 'success');
                await new Promise(r => setTimeout(r, 500));
                
                // 4. Verificar se foi salvo
                const { data: usuarioSalvo, error: errorCheck } = await client
                    .from('usuarios')
                    .select('*')
                    .eq('id', novoUsuario.id)
                    .single();
                
                if (errorCheck || !usuarioSalvo) {
                    throw new Error('UsuÃ¡rio nÃ£o foi encontrado apÃ³s inserÃ§Ã£o!');
                }
                
                // SUCESSO!
                mostrarResultado(`ğŸ‰ TESTE 100% CONCLUÃDO COM SUCESSO! ğŸ‰

âœ… Passo 1: Cliente criado
âœ… Passo 2: Tabela acessÃ­vel
âœ… Passo 3: UsuÃ¡rio inserido
âœ… Passo 4: Dados confirmados

ğŸ“Š DADOS DO USUÃRIO CRIADO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ID: ${usuarioSalvo.id}
Nome: ${usuarioSalvo.nome_completo}
Email: ${usuarioSalvo.email}
Tipo: ${usuarioSalvo.tipo}
Idade: ${usuarioSalvo.idade} anos
Peso: ${usuarioSalvo.peso} kg
Altura: ${usuarioSalvo.altura} cm
Data de cadastro: ${new Date(usuarioSalvo.created_at).toLocaleString('pt-BR')}

ğŸ¯ O SISTEMA ESTÃ FUNCIONANDO PERFEITAMENTE!

Agora vocÃª pode usar o cadastro normalmente.
Teste em: cadastro.html`, 'success');
                
                btn.textContent = 'âœ… TESTE CONCLUÃDO!';
                btn.style.background = '#4caf50';
                
            } catch (error) {
                mostrarResultado(`âŒ ERRO NO TESTE:

${error.message}

ğŸ“‹ STACK TRACE:
${error.stack || 'NÃ£o disponÃ­vel'}

ğŸ”§ POSSÃVEIS SOLUÃ‡Ã•ES:

1. ERRO DE PERMISSÃƒO (42501):
   - Execute o SQL de polÃ­ticas RLS no Supabase
   - Settings â†’ SQL Editor â†’ Cole o cÃ³digo do supabase-schema.sql

2. ERRO DE TABELA (42P01):
   - A tabela 'usuarios' nÃ£o existe
   - Execute o SQL completo no SQL Editor

3. ERRO DE CONEXÃƒO:
   - Verifique se as credenciais estÃ£o corretas
   - Verifique sua conexÃ£o com a internet

4. ERRO DE FETCH:
   - O projeto pode estar pausado/suspenso
   - Acesse o dashboard e verifique o status`, 'error');
                
                btn.textContent = 'âŒ TESTE FALHOU - Tente Novamente';
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
